<div data-cy="mock-wrapper" class="xs:container px-10 md:mx-auto">
  <div class="grid grid-cols-2 gap-6 pt-10" *ngIf="selectedProject$ | async as project">
    <div>
      <header class="dark:border-blend-50 flex flex-row items-center border-b border-gray-100 pb-3">
        <h2 data-cy="mock-project-name">
          <strong>Project</strong>: {{ project.name | titlecase }}
          <small data-cy="mock-project-nam-slug">(slug: {{ project.slug }})</small>
        </h2>
        <div class="ml-auto">
          <button
            data-cy="mock-import-bottom"
            type="button"
            label="Import"
            class="dark:border-blend-50 hover:dark:bg-blend-100 mr-2 rounded-md border border-gray-200 p-2 hover:bg-gray-100"
          >
            Import
          </button>
          <button
            data-cy="mock-export-bottom"
            type="button"
            label="Export"
            class="dark:border-blend-50 hover:dark:bg-blend-100 rounded-md border border-gray-200 p-2 hover:bg-gray-100"
          >
            Export
          </button>
        </div>
      </header>
      <div class="py-5">
        <ng-container *ngIf="collections$ | async as collections">
          <ng-container
            *ngTemplateOutlet="
              collections.length ? collectionPanel : noCollectionsFound;
              context: { collections: this.collections }
            "
          ></ng-container>
        </ng-container>
      </div>
    </div>
    <div class="">
      <ng-container
        *ngIf="endpointLoaded$ | async as loading; then loadedEndpoint; else loadingEndpoint"
      ></ng-container>
    </div>
  </div>
</div>

<ng-template #collectionPanel let-collections="collections">
  <section cdkDropListGroup>
    <ay-collection-panel *ngFor="let collection of collections">
      <section
        data-cy="endpoints-list"
        class="dark:border-blend-50 mb-4 rounded-md border border-dashed border-gray-100 p-2 text-sm"
      >
        <header class="flex flex-row p-2">
          <h5 class="text-muted text-sm font-bold capitalize">{{ collection.name }}</h5>
          <section class="ml-auto">
            <button class="cursor-pointer p-2"><i class="fa fa-cog"></i></button>
          </section>
        </header>

        <section
          class="drop-list p-4 px-2"
          cdkDropList
          (cdkDropListDropped)="drop($event)"
          [cdkDropListData]="collection.endpoints"
          id="{{ collection.id }}"
        >
          <div cdkDrag cdkDragLockAxis="y" *ngFor="let endpoint of collection.endpoints">
            <div class="example-custom-placeholder" *cdkDragPlaceholder></div>
            <ay-endpoint-link
              [isSelected]="endpoint.id === (selectedEndpoint$ | async)"
              [method]="endpoint.method"
              [path]="endpoint.path"
              (selectEndpoint)="onEndpointSelect(endpoint.id)"
            ></ay-endpoint-link>
          </div>
        </section>
      </section>
    </ay-collection-panel>
  </section>
</ng-template>

<ng-template #endpointLinks let-collection="collection"> </ng-template>

<ng-template #noEndpoints>
  <p class="italic">No endpoints in this collection.</p>
</ng-template>

<ng-template #noCollectionsFound>
  <p data-cy="endpoints-no-endpoints-found" class="text-sm">No endpoints found.</p>
</ng-template>

<ng-template #loadingEndpoint let-loading>
  <section class="p-5 pt-7 text-center text-sm">
    <ng-container *ngIf="loading === null">
      <p data-cy="endpoints-no-endpoint-selected" class="text-xs">Please select an endpoint on the left.</p>
    </ng-container>

    <ng-container *ngIf="isBoolean(loading)">
      <ay-loader></ay-loader>
    </ng-container>
  </section>
</ng-template>

<ng-template #loadedEndpoint>
  <ng-container *ngIf="endpoint$ | async as endpoint">
    <div
      data-cy="endpoint-details-screen"
      class="dark:border-blend-50 flex flex-row items-center border-b border-gray-100 pb-3"
    >
      <span class="font-bold">Details</span>
      <button
        data-cy="endpoint-details-update-button"
        class="ml-auto mr-2 rounded bg-blue-500 p-2 px-4 text-white"
        label="Update"
        (click)="updateEndpoint()"
      >
        Update
      </button>
    </div>
    <ay-endpoint-options
      *ngIf="availableStatusCodes$ | async as availableStatusCodes"
      [availableStatusCodes]="availableStatusCodes"
      [activeStatusCode]="activeStatusCode$ | async"
      [endpoint]="endpoint"
      [configurationForm]="configurationForm"
    ></ay-endpoint-options>
    <ay-response-list
      *ngIf="availableStatusCodes$ | async as availableStatusCodes"
      [availableStatusCodes]="availableStatusCodes"
      [activeStatusCode]="activeStatusCode$ | async"
      [responseArrayForm]="responseArrayForm"
      (viewResponseBody)="onViewResponseBody($event)"
    ></ay-response-list>
    <div style="height: 600px">
      <ay-editor
        style="height: 100%"
        [content]="selectedResponseBody || ''"
        (contentChange)="onUpdateResponse($event)"
      ></ay-editor>
    </div>
  </ng-container>
</ng-template>
